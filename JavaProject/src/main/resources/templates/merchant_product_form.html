<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title
        th:text="${product.id != null ? #messages.msg('product.form.title.edit') : #messages.msg('product.form.title.add')}">
        Məhsul | Marketplace</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <nav class="navbar">
        <div class="nav-brand" th:text="#{nav.brand}">Marketplace - Satıcı Paneli</div>
        <div class="nav-links">
            <a th:href="@{/merchant/dashboard(merchantId=${merchantId})}" class="nav-link" th:text="#{nav.home}">Ana
                Səhifə</a>
            <a th:href="@{/merchant/products(merchantId=${merchantId})}" class="nav-link"
                th:text="#{nav.products}">Məhsullar</a>
            <a th:href="@{/merchant/orders(merchantId=${merchantId})}" class="nav-link"
                th:text="#{nav.orders}">Sifarişlər</a>
            <div style="margin-left: 1rem; color: var(--text-secondary);">
                <a th:href="@{/merchant/products/add(merchantId=${merchantId}, lang='az')}"
                    th:if="${product.id == null}" style="color: inherit; text-decoration: none;"
                    th:style="${#locale.language == 'az' ? 'font-weight: bold; color: var(--accent-color);' : ''}">AZ</a>
                <a th:href="@{/merchant/products/edit/{id}(id=${product.id}, merchantId=${merchantId}, lang='az')}"
                    th:if="${product.id != null}" style="color: inherit; text-decoration: none;"
                    th:style="${#locale.language == 'az' ? 'font-weight: bold; color: var(--accent-color);' : ''}">AZ</a>
                |
                <a th:href="@{/merchant/products/add(merchantId=${merchantId}, lang='en')}"
                    th:if="${product.id == null}" style="color: inherit; text-decoration: none;"
                    th:style="${#locale.language == 'en' ? 'font-weight: bold; color: var(--accent-color);' : ''}">EN</a>
                <a th:href="@{/merchant/products/edit/{id}(id=${product.id}, merchantId=${merchantId}, lang='en')}"
                    th:if="${product.id != null}" style="color: inherit; text-decoration: none;"
                    th:style="${#locale.language == 'en' ? 'font-weight: bold; color: var(--accent-color);' : ''}">EN</a>
            </div>
            <a th:href="@{/auth/logout}" class="nav-link" style="margin-left:1rem;">Çıxış</a>
        </div>
    </nav>

    <div class="container animate-fade-in">
        <a th:href="@{/merchant/products(merchantId=${merchantId})}"
            style="display: inline-block; margin-bottom: 2rem; color: var(--text-secondary);"
            th:text="#{product.form.back}">← Məhsullara Qayıt</a>

        <div class="card" style="max-width: 800px; margin: 0 auto;">
            <h1 th:text="${product.id != null ? #messages.msg('product.form.title.edit') : #messages.msg('product.form.title.add')}"
                style="margin-bottom: 2rem;">Məhsul</h1>

            <form th:action="${product.id != null ? '/merchant/products/edit/' + product.id : '/merchant/products/add'}"
                method="post" th:object="${product}" enctype="multipart/form-data">
                <input type="hidden" name="merchantId" th:value="${merchantId}" />

                <div class="form-group">
                    <label th:text="#{product.form.name}">Məhsul Adı</label>
                    <input type="text" th:field="*{name}" th:placeholder="#{product.form.name.placeholder}" required />
                </div>

                <div class="form-group">
                    <label th:text="#{product.form.description}">Təsvir</label>
                    <textarea th:field="*{details}" th:placeholder="#{product.form.description.placeholder}" rows="4"
                        required></textarea>
                </div>



                <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;\">
                    <div class=\"form-group\">
                        <label th:text=\"#{product.form.price}\">Qiymət (₼)</label>
                        <input type=\"number\" th:field=\"*{price}\" step=\"0.01\" min=\"0\" placeholder=\"0.00\" required />
                    </div>

                    <div class=\"form-group\">
                        <label th:text=\"#{product.form.stock}\">Stok Sayı</label>
                        <input type=\"number\" th:field=\"*{stockCount}\" min=\"0\" placeholder=\"0\" required />
                    </div>
                </div>

                <div class=\"form-group\">
                    <label>Product Images</label>
                    <input type=\"file\" name=\"productImages\" accept=\"image/*\" multiple 
                           style=\"padding: 0.75rem; border: 2px dashed var(--border-color); border-radius: 8px; background: rgba(255,255,255,0.05);\" />
                    <small style=\"color: var(--text-secondary); margin-top: 0.5rem; display: block;\">
                        You can upload multiple images (max 5MB each)
                    </small>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label th:text="#{product.form.category}">Kateqoriya</label>
                        <select th:field="*{category.id}" required>
                            <option value="" th:text="#{product.form.select}">Seçin...</option>
                            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}">Kateqoriya
                            </option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label th:text="#{product.form.brand}">Brend</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <select th:field="*{brand.id}" id="brandSelect" style="flex: 1;">
                                <option value="" th:text="#{product.form.select}">Seçin...</option>
                                <option th:each="brand : ${brands}" th:value="${brand.id}" th:text="${brand.name}">Brend
                                </option>
                            </select>
                            <button type="button" onclick="toggleNewBrand()" id="newBrandBtn"
                                style="padding: 0 1rem; background: var(--accent-color); color: white; border-radius: 8px; white-space: nowrap;"
                                th:text="#{product.form.new_brand}">
                                + Yeni
                            </button>
                        </div>
                    </div>
                </div>

                <div id="newBrandSection"
                    style="display: none; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px dashed var(--border-color);">
                    <h3 style="margin-bottom: 1rem; font-size: 1.1rem;" th:text="#{product.form.new_brand.title}">Yeni
                        Brend Əlavə Et</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label th:text="#{product.form.new_brand.name}">Brend Adı</label>
                            <input type="text" name="newBrandName" id="newBrandName"
                                th:placeholder="#{product.form.new_brand.placeholder}" />
                        </div>

                    </div>
                </div>

                <div class="form-group">
                    <label>Məhsul Şəkilləri</label>
                    <input type="file" name="images" multiple accept="image/*" 
                        style="padding: 0.75rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary);" />
                    <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                        Bir və ya bir neçə şəkil seçə bilərsiniz (JPG, PNG)
                    </small>
                </div>

                <button type="submit" style="width: 100%; margin-top: 1rem;"
                    th:text="${product.id != null ? #messages.msg('product.form.update') : #messages.msg('product.form.add')}">Əlavə
                    Et</button>
            </form>
        </div>
    </div>

    <script th:inline="javascript">
        function toggleNewBrand() {
            const section = document.getElementById('newBrandSection');
            const select = document.getElementById('brandSelect');
            const btn = document.getElementById('newBrandBtn');
            const nameInput = document.getElementById('newBrandName');

            /*[[#{product.form.cancel}]]*/
            const cancelText = 'Ləğv Et';
            /*[[#{product.form.new_brand}]]*/
            const newText = '+ Yeni';

            if (section.style.display === 'none') {
                section.style.display = 'block';
                select.disabled = true;
                select.value = '';
                btn.textContent = cancelText;
                btn.style.background = 'var(--danger-color)';
                nameInput.required = true;
            } else {
                section.style.display = 'none';
                select.disabled = false;
                btn.textContent = newText;
                btn.style.background = 'var(--accent-color)';
                nameInput.value = '';
                nameInput.required = false;
            }
        }
    </script>
</body>

</html>